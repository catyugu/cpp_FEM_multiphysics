# **Plan V1.2**

本计划将围绕您已实现的静磁场求解器，进行商业级标准的测试、性能优化，并深入学习与其相关的高级理论，为求解器未来的发展铺路。

## **第一周：求解器强化周 —— 测试、优化与重构**

本周的目标是将您现有的静磁场求解器打磨得更加**精确、高效和健壮**。

* **第 1-2 天：全面测试与精度验证 (Testing & Validation)**
    * **目标**：确保求解器的正确性，使其达到可信赖的水平。
    * **上午 (理论)**：回顾有限元验证方法。学习如何设计 Benchmark 测试用例，特别是寻找那些具有解析解的经典电磁学问题（例如，无限长螺线管、亥姆霍兹线圈等）。
    * **下午 (实践)**：
        * **扩展测试用例**：在 `tests/test_magnetostatics_3d.cpp` 的基础上，增加更严格的测试。
        * **定量验证**：编写一个新的后处理器（类似于 `HeatFluxCalculator`），用于计算磁场 **B** = ∇×**A**。在测试中，将计算出的 **B** 场与解析解进行**定量**比较，并使用断言（ASSERT）来验证误差是否在允许范围内。
        * **高阶单元测试**：确保您的测试覆盖了二阶甚至更高阶单元，验证其收敛性和精度优势。

* **第 3-4 天：性能分析与代码优化 (Performance & Optimization)**
    * **目标**：找出性能瓶颈，显著提升求解速度。
    * **上午 (理论)**：
        * 深入学习您已使用的 `BiCGSTAB` 迭代求解器，重点理解其收敛特性和影响因素。
        * 研究**预条件器 (Preconditioners)** 理论，这是加速迭代求解器的核心技术。了解常见的预条件器，如对角（Jacobi）、不完全LU分解（ILU）等。
    * **下午 (实践)**：
        * **性能剖析 (Profiling)**：使用性能分析工具（如 Gprof, Valgrind/Callgrind,或IDE自带的分析器）来运行您的螺线管测试，找出最耗时的函数，很可能是矩阵组装或线性求解部分。
        * **矩阵组装优化**：分析 `Magnetic3D::assemble` 的效率。思考是否可以通过并行化（您已引入OpenMP）来加速单元循环。
        * **求解器优化**：在 `LinearSolver::solve` 中，为 Eigen 的 `BiCGSTAB` 配置一个预条件子（例如 `Eigen::IncompleteLUT`），并对比其与无预条件情况下的迭代次数和求解时间。

* **第 5-7 天：理论深化与项目重构 (Theory & Refactoring)**
    * **目标**：巩固理论知识，并根据“成熟FEM核心”的理念重构代码。
    * **上午 (理论)**：
        * **深入有限元理论**：重新阅读有限元理论教材中关于矢量亥姆霍兹方程、边缘元（Edge Elements）和散度无散（Divergence-Free）基函数等高级主题。理解为什么对于电磁场仿真，使用边缘元通常比节点元更优越。
        * **电磁仿真技巧**：学习处理开放边界问题的方法，如吸收边界条件（ABC）、完美匹配层（PML）等。
    * **下午 (重构与文档)**：
        * **代码重构**：审视您的 `PhysicsField` 和 `Element` 类。思考如何实现 `prompt.md` 中提出的终极目标：`PhysicsField -> asks an Element for its pre-calculated FEValues -> simply uses those values to fill the matrix`。这可能需要您将 `FEValues` 的创建逻辑移到 `Element` 类内部。
        * **提高测试覆盖率**：为您项目的核心模块（如 `DOFManager`, `FEValues`, `Material`）编写更多的单元测试，确保代码的健壮性。
        * **文档完善**：为您在上一阶段完成的静磁场模块，在 `docs/` 目录下补充详细的 Markdown 文档，解释其实现原理和使用方法。

## **第二周：知识拓展周 —— 进军高频与前沿领域**

本周的目标是跳出静磁场的范畴，为您的求解器未来支持更广泛、更复杂的电磁仿真问题（特别是芯片封装和微波领域）打下坚实的理论和技术基础。

* **第 8-10 天：微波工程与传输线理论 (Microwave Engineering)**
    * **目标**：掌握高频电磁场分析所需的核心理论知识。
    * **全天 (理论学习)**：
        * 系统学习**传输线理论**：理解TEM、TE、TM波的概念，学习特性阻抗、反射与传输、史密斯圆图等核心工具。
        * 学习**网络分析**：深入理解**S参数（散射参数）**的物理意义和应用。这是衡量微波器件性能的通用语言。
        * 初步了解**波导和天线**：了解矩形/圆形波导中的模式，以及天线的辐射、增益、方向图等基本概念。这将帮助您理解芯片封装中的信号完整性（Signal Integrity）和电磁兼容性（EMC）问题。

* **第 11-12 天：频域求解器规划 (Frequency-Domain Solver)**
    * **目标**：为实现处理**时谐问题**的频域求解器制定清晰的技术路线。
    * **上午 (理论)**：
        * 将麦克斯韦方程组变换到**频域（Phasor Domain）**，推导**矢量亥姆霍兹方程**。
        * 理解频域求解的输出是**复数**，代表场量的幅度和相位。
    * **下午 (项目规划)**：
        * **技术选型**：调研如何在您的项目中支持复数运算。Eigen 库本身就提供了 `Eigen::SparseMatrix<std::complex<double>>` 等类型，这会非常方便。
        * **架构设计**：规划一个新的 `Solver` 类型，例如 `FrequencyDomainSolver`。思考如何在 `Problem` 类中进行切换，以及 `PhysicsField` 的 `assemble` 方法需要做哪些调整来构建复数矩阵。

* **第 13-14 天：总结与未来路线图 (Roadmap)**
    * **目标**：巩固所学，并为您的项目制定一个激动人心的长期发展路线图。
    * **上午 (总结与展望)**：
        * 回顾两周的学习成果，特别是性能优化的效果和对高频理论的理解。
        * 思考如何将微波理论知识应用到具体的仿真问题上，例如仿真一个微带线或同轴连接器的S参数。
    * **下午 (规划)**：
        * **制定下一步计划**：明确您下一个开发周期（例如一个月）的核心目标。是实现频域求解器？还是支持非线性材料（如磁饱和）？
        * **商业化思考**：思考要让项目达到商业内核的水平，还需要哪些功能？（例如：更强大的网格处理能力、更丰富的后处理选项、图形用户界面GUI等）。将这些想法整理成一个清晰的路线图。